#!/usr/bin/env node
var debug = require('debug')('my-application');
var app = require('../app').app;
var https_options = require('../app').https_options
var https = require('https')
var io = require('socket.io')
var httpsForWebsockets = https.createServer(https_options, app).listen(process.env.PORT || 3000)
// = https.createServer(https_options, app)
var websocket = io.listen(httpsForWebsockets)
console.log(httpsForWebsockets)

require("http").createServer(function(req, res){
     console.log(req.headers.host)
     console.log(req.headers)
     
     host = req.headers.host.split(":")
     host[1] = 3000;
     host = host.join(":")
     console.log(host)

     res.writeHead(301, {
       'Content-Type': 'text/plain', 
       'Location':'https://'+host+req.url});
     res.end('Redirecting to SSL\n');
  }).listen(3001);

websocket.sockets.on('connection', function (socket) {
  socket.on('getData', function (options,id) {
     var data={"message":"Hello World!", options:options};
     socket.emit("gotData",data,id); });
  }
).on('getOtherData', function(options,id) {
     var otherData={"result":42}; 
     socket.emit("gotData",otherData,id); 
  }
);

/*app.set('port', process.env.PORT || 3000);

var server = app.listen(app.get('port'), function() {
  debug('Express server listening on port ' + server.address().port);
});
*/
